---
title: Ubuntuç£ç›˜æŒ‚è½½ä»¥åŠè‡ªåŠ¨é‡å¯æŒ‚è½½é…ç½®
tags:
  - Ubuntu
---

# Ubuntuç£ç›˜æŒ‚è½½ä»¥åŠè‡ªåŠ¨é‡å¯æŒ‚è½½é…ç½®

å½“æˆ‘ä»¬æœåŠ¡å™¨SSDå­˜å‚¨è¾¾åˆ°ä¸Šé™ï¼Œéœ€è¦å¯¹ç°æœ‰æœºå™¨è¿›è¡Œæ‰©å®¹ã€‚

é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œæ–‡ä»¶ç³»ç»Ÿå¤§æ¦‚åˆ†2ä¸­ï¼Œå³ï¼šxfs å’Œ ext4ï¼Œcentos/redhat 7 é»˜è®¤å°†æ–‡ä»¶ç³»ç»Ÿè®¾ç½®ä¸ºxfsã€‚**é«˜å¹¶å‘å‹åŠ›ä¸‹ xfs çš„æ€§èƒ½æ¯” ext4 é«˜ 5-10% å·¦å³ã€‚å¯¹åº”çš„ioåˆ©ç”¨ç‡ xfs æ˜æ˜¾æ¯”ext4ä½**ã€‚æ‰€ä»¥xfsæ˜¯å½“å‰çš„æœ€ä½³é€‰æ‹©ã€‚



 ### å°†å®ä¾‹å­˜å‚¨å·æ·»åŠ åˆ°å®ä¾‹

å½“æˆ‘ä»¬å¾—åˆ°ä¸€å¼ å·(Volume)æ—¶ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ°EC2å®ä¾‹ï¼Œä¹‹åéœ€è¦è¿æ¥åˆ° Linux å®ä¾‹ï¼Œè¿›è¡Œå®‰è£…ï¼š



1.ç”¨ `df -h` å‘½ä»¤æŸ¥çœ‹å·²æ ¼å¼åŒ–å¹¶æŒ‚è½½çš„å·

```
root@ip-172-31-62-192:/# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root        39G  4.4G   35G  12% /
devtmpfs        3.9G     0  3.9G   0% /dev
tmpfs           3.9G     0  3.9G   0% /dev/shm
tmpfs           788M  864K  787M   1% /run
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup
/dev/loop1       56M   56M     0 100% /snap/core18/2128
/dev/loop2       56M   56M     0 100% /snap/core18/2253
/dev/loop0       25M   25M     0 100% /snap/amazon-ssm-agent/4046
/dev/loop3       62M   62M     0 100% /snap/core20/1270
/dev/loop4       68M   68M     0 100% /snap/lxd/21835
/dev/loop7       62M   62M     0 100% /snap/core20/1169
/dev/loop5       68M   68M     0 100% /snap/lxd/21545
/dev/loop6       44M   44M     0 100% /snap/snapd/14295
/dev/loop8       33M   33M     0 100% /snap/snapd/13640
tmpfs           788M     0  788M   0% /run/user/0
```

2.ä½¿ç”¨ `lsblk` æŸ¥çœ‹åœ¨å¯åŠ¨æ—¶å·²æ˜ å°„ä½†æœªæ ¼å¼åŒ–å’Œè£…è½½çš„æ‰€æœ‰å·

```
root@ip-172-31-62-192:/# lsblk
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
loop0         7:0    0   25M  1 loop /snap/amazon-ssm-agent/4046
loop1         7:1    0 55.4M  1 loop /snap/core18/2128
loop2         7:2    0 55.5M  1 loop /snap/core18/2253
loop3         7:3    0 61.9M  1 loop /snap/core20/1270
loop4         7:4    0 67.2M  1 loop /snap/lxd/21835
loop5         7:5    0 67.3M  1 loop /snap/lxd/21545
loop6         7:6    0 43.3M  1 loop /snap/snapd/14295
loop7         7:7    0 61.9M  1 loop /snap/core20/1169
loop8         7:8    0 32.5M  1 loop /snap/snapd/13640
nvme1n1     259:0    0  100G  0 disk
nvme0n1     259:1    0   40G  0 disk
â””â”€nvme0n1p1 259:2    0   40G  0 part /
```

3.ä½¿ç”¨ `mkfs` å‘½ä»¤åœ¨è®¾å¤‡ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ

```
sudo mkfs -t xfs /dev/nvme1n1

```



4.ä½¿ç”¨ `mkdir` å‘½ä»¤åˆ›å»ºè¦å°†è®¾å¤‡æŒ‚è½½åˆ°çš„ç›®å½•

```
sudo mkdir /data
```

5.ä½¿ç”¨ `mount` å‘½ä»¤åœ¨æ–°å»ºç›®å½•ä¸ŠæŒ‚è½½è®¾å¤‡

```
sudo mount /dev/nvme1n1 /data
```

6.æŸ¥çœ‹æŒ‚è½½ç»“æœ

```
sudo lsblk -f æˆ– df -h
```



### é‡å¯åè‡ªåŠ¨æŒ‚è½½é™„åŠ çš„å·

1.ï¼ˆå¯é€‰ï¼‰åˆ›å»º `/etc/fstab` æ–‡ä»¶çš„å¤‡ä»½ï¼Œä»¥ä¾¿åœ¨ç¼–è¾‘æ—¶è¯¯æŸåæˆ–åˆ é™¤æ­¤æ–‡ä»¶æ—¶ä½¿ç”¨ã€‚

```
sudo cp /etc/fstab /etc/fstab.orig
```

2.ä½¿ç”¨ **blkid** å‘½ä»¤æŸ¥æ‰¾è®¾å¤‡çš„ UUIDã€‚`/dev/nvme1n1`æ˜¯æˆ‘ä»¬è¦æ“ä½œçš„å·ï¼Œè®°ä¸‹ UUIDï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­æ‚¨å°†éœ€è¦ç”¨åˆ°å®ƒã€‚

```
root@ip-172-31-62-192:/# blkid
/dev/nvme1n1: UUID="c9c99018-1fcb-4f95-a991-4039fa738b8c" TYPE="xfs"
/dev/nvme0n1p1: LABEL="cloudimg-rootfs" UUID="2a29f520-1100-4824-b5d9-d841f1267838" TYPE="ext4" PARTUUID="3fa6b62f-01"
```

3.ç¼–è¾‘fstabæ–‡ä»¶

```
sudo vim /etc/fstab
```

æˆ‘ä»¬å°† UUID ä¸º `c9c99018-1fcb-4f95-a991-4039fa738b8c` çš„è®¾å¤‡æŒ‚è½½åˆ°æŒ‚è½½ç‚¹ `/revoloiot`ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨ `xfs` æ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨ `defaults` å’Œ `nofail` æ ‡å¿—ã€‚æˆ‘ä»¬æŒ‡å®š `0` ä»¥é˜²æ­¢æ–‡ä»¶ç³»ç»Ÿè¢«è½¬å‚¨ï¼Œå¹¶ä¸”æˆ‘ä»¬æŒ‡å®š `2` ä»¥æŒ‡ç¤ºå®ƒæ˜¯éæ ¹è®¾å¤‡ã€‚

```
LABEL=cloudimg-rootfs   /        ext4   defaults,discard        0 1
# æ ¹æ®uuidæŒ‚è½½
UUID=c9c99018-1fcb-4f95-a991-4039fa738b8c   /data xfs  defaults 0 1
# æ ¹æ®è·¯å¾„æŒ‚è½½(æ¨è)
/dev/sdb /data xfs  defaults 0 1
```

**UUIDå’Œæ–‡ä»¶ç±»å‹å¿…é¡»ä¸ç¬¬2æ­¥ä¸­ä¸€è‡´ï¼Œå¦åˆ™å°†å¤±è´¥**

4.æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ

```
sudo mount -a
```

ğŸº å¦‚æœæœªäº§ç”Ÿé”™è¯¯ï¼Œåˆ™è¯´æ˜ `/etc/fstab` æ–‡ä»¶æ­£å¸¸ï¼Œæ‚¨çš„æ–‡ä»¶ç³»ç»Ÿä¼šåœ¨é‡å¯åè‡ªåŠ¨æŒ‚è½½ã€‚



### ubuntu å¦‚ä½•å°†Amazon EBS(ä½œä¸ºæ ¹ç›®å½•è£…è½½)çš„å¤§å°è°ƒæ•´

ubuntu ç£ç›˜æ‰©å®¹ä¸liunxæœ‰æ‰€åŒºåˆ«ï¼ŒåŒæ—¶ï¼Œéœ€è¦æ³¨æ„ç£ç›˜åˆ†åŒºæ ¼å¼çš„ä¸åŒï¼Œå‘½ä»¤æœ‰ç»†å¾®å·®å¼‚ã€‚

```
$ lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
loop0         7:0    0  55.6M  1 loop /snap/core18/2679
loop1         7:1    0 116.7M  1 loop /snap/core/14447
loop2         7:2    0  25.1M  1 loop /snap/amazon-ssm-agent/5656
loop3         7:3    0 116.7M  1 loop /snap/core/14399
loop4         7:4    0  55.6M  1 loop /snap/core18/2667
loop5         7:5    0  24.4M  1 loop /snap/amazon-ssm-agent/6312
nvme0n1     259:0    0     3T  0 disk 
â””â”€nvme0n1p1 259:1    0     2T  0 part /
$ df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
udev           devtmpfs  7.7G     0  7.7G   0% /dev
tmpfs          tmpfs     1.6G  780K  1.6G   1% /run
/dev/nvme0n1p1 ext4      2.0T  1.9T   43G  98% /
tmpfs          tmpfs     7.7G   64K  7.7G   1% /dev/shm
tmpfs          tmpfs     5.0M     0  5.0M   0% /run/lock
tmpfs          tmpfs     7.7G     0  7.7G   0% /sys/fs/cgroup
/dev/loop0     squashfs   56M   56M     0 100% /snap/core18/2679
/dev/loop1     squashfs  117M  117M     0 100% /snap/core/14447
/dev/loop2     squashfs   26M   26M     0 100% /snap/amazon-ssm-agent/5656
/dev/loop3     squashfs  117M  117M     0 100% /snap/core/14399
/dev/loop5     squashfs   25M   25M     0 100% /snap/amazon-ssm-agent/6312
/dev/loop4     squashfs   56M   56M     0 100% /snap/core18/2667
tmpfs          tmpfs     1.6G     0  1.6G   0% /run/user/1000
$ sudo gdisk /dev/nvme1n1
GPT fdisk (gdisk) version 1.0.3
Partition table scan:
  MBR: MBR only
  BSD: not present
  APM: not present
  GPT: not present
***************************************************************
Found invalid GPT and valid MBR; converting MBR to GPT format
in memory. THIS OPERATION IS POTENTIALLY DESTRUCTIVE! Exit by
typing 'q' if you don't want to convert your MBR partitions
to GPT format!
***************************************************************
Command (? for help): w
Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!
Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/nvme1n1.
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot or after you
run partprobe(8) or kpartx(8)
The operation has completed successfully.
$ sudo gdisk /dev/nvme1n1
GPT fdisk (gdisk) version 1.0.3
Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present
Found valid GPT with protective MBR; using GPT.
Command (? for help): q
$ sudo parted /dev/nvme1n1
GNU Parted 3.2
Using /dev/nvme1n1
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) print                                                            
Model: Amazon Elastic Block Store (nvme)
Disk /dev/nvme1n1: 3221GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 
Number  Start   End     Size    File system  Name              Flags
 1      1049kB  2199GB  2199GB  ext4         Linux filesystem
(parted) resizepart                                                       
Partition number? 1                                                       
Warning: Partition /dev/nvme0n1p1 is being used. Are you sure you want to continue?
Yes/No? yes                                                               
End?  [2199GB]? 3000GB                                                    
(parted) print                                                            
Model: Amazon Elastic Block Store (nvme)
Disk /dev/nvme1n1: 3221GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 
Number  Start   End     Size    File system  Name              Flags
 1      1049kB  3000GB  3000GB  ext4         Linux filesystem
(parted) q                                                                
Information: You may need to update /etc/fstab.
$ blkid                                           
/dev/nvme1n1: LABEL="cloudimg-rootfs" UUID="90e1dfca-b055-4f93-b62e-6347bcb451a7" TYPE="ext4" PARTUUID="f7355124-01"
$ cat /etc/fstab 
LABEL=cloudimg-rootfs   /    ext4   defaults,discard    0 0
$ lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
loop0         7:0    0  55.6M  1 loop /snap/core18/2679
loop1         7:1    0 116.7M  1 loop /snap/core/14447
loop2         7:2    0  25.1M  1 loop /snap/amazon-ssm-agent/5656
loop3         7:3    0 116.7M  1 loop /snap/core/14399
loop4         7:4    0  55.6M  1 loop /snap/core18/2667
loop5         7:5    0  24.4M  1 loop /snap/amazon-ssm-agent/6312
nvme0n1     259:0    0     3T  0 disk 
â””â”€nvme0n1p1 259:1    0   2.7T  0 part /
$ df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
udev           devtmpfs  7.7G     0  7.7G   0% /dev
tmpfs          tmpfs     1.6G  780K  1.6G   1% /run
/dev/nvme0n1p1 ext4      2.0T  1.9T   43G  98% /
tmpfs          tmpfs     7.7G   64K  7.7G   1% /dev/shm
tmpfs          tmpfs     5.0M     0  5.0M   0% /run/lock
tmpfs          tmpfs     7.7G     0  7.7G   0% /sys/fs/cgroup
/dev/loop0     squashfs   56M   56M     0 100% /snap/core18/2679
/dev/loop1     squashfs  117M  117M     0 100% /snap/core/14447
/dev/loop2     squashfs   26M   26M     0 100% /snap/amazon-ssm-agent/5656
/dev/loop3     squashfs  117M  117M     0 100% /snap/core/14399
/dev/loop5     squashfs   25M   25M     0 100% /snap/amazon-ssm-agent/6312
/dev/loop4     squashfs   56M   56M     0 100% /snap/core18/2667
tmpfs          tmpfs     1.6G     0  1.6G   0% /run/user/1000
#$ sudo resize2fs /dev/nvme1n1 
resize2fs 1.44.1 (24-Mar-2018)
Filesystem at /dev/nvme0n1p1 is mounted on /; on-line resizing required
old_desc_blocks = 256, new_desc_blocks = 350
The filesystem on /dev/nvme0n1p1 is now 732421619 (4k) blocks long.
$ df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
udev           devtmpfs  7.7G     0  7.7G   0% /dev
tmpfs          tmpfs     1.6G  780K  1.6G   1% /run
/dev/nvme0n1p1 ext4      2.0T  1.9T   43G  98% /
tmpfs          tmpfs     7.7G   64K  7.7G   1% /dev/shm
tmpfs          tmpfs     5.0M     0  5.0M   0% /run/lock
tmpfs          tmpfs     7.7G     0  7.7G   0% /sys/fs/cgroup
/dev/loop0     squashfs   56M   56M     0 100% /snap/core18/2679
/dev/loop1     squashfs  117M  117M     0 100% /snap/core/14447
/dev/loop2     squashfs   26M   26M     0 100% /snap/amazon-ssm-agent/5656
/dev/loop3     squashfs  117M  117M     0 100% /snap/core/14399
/dev/loop5     squashfs   25M   25M     0 100% /snap/amazon-ssm-agent/6312
/dev/loop4     squashfs   56M   56M     0 100% /snap/core18/2667
tmpfs          tmpfs     1.6G     0  1.6G   0% /run/user/1000
## resize2fs å‘½ä»¤ ï¼šé’ˆå¯¹çš„æ˜¯ext2ã€ext3ã€ext4æ–‡ä»¶ç³»ç»Ÿ
## xfs_growfs å‘½ä»¤ ï¼šé’ˆå¯¹çš„æ˜¯xfsæ–‡ä»¶ç³»ç»Ÿ
$ sudo xfs_growfs /dev/nvme1n1 
resize2fs 1.44.1 (24-Mar-2018)
Filesystem at /dev/nvme0n1p1 is mounted on /; on-line resizing required
old_desc_blocks = 256, new_desc_blocks = 350
The filesystem on /dev/nvme0n1p1 is now 732421619 (4k) blocks long.
$ df -hT
Filesystem     Type      Size  Used Avail Use% Mounted on
udev           devtmpfs  7.7G     0  7.7G   0% /dev
tmpfs          tmpfs     1.6G  780K  1.6G   1% /run
/dev/nvme0n1p1 ext4      2.7T  1.9T  767G  72% /
tmpfs          tmpfs     7.7G   64K  7.7G   1% /dev/shm
tmpfs          tmpfs     5.0M     0  5.0M   0% /run/lock
tmpfs          tmpfs     7.7G     0  7.7G   0% /sys/fs/cgroup
/dev/loop0     squashfs   56M   56M     0 100% /snap/core18/2679
/dev/loop1     squashfs  117M  117M     0 100% /snap/core/14447
/dev/loop2     squashfs   26M   26M     0 100% /snap/amazon-ssm-agent/5656
/dev/loop3     squashfs  117M  117M     0 100% /snap/core/14399
/dev/loop5     squashfs   25M   25M     0 100% /snap/amazon-ssm-agent/6312
/dev/loop4     squashfs   56M   56M     0 100% /snap/core18/2667
tmpfs          tmpfs     1.6G     0  1.6G   0% /run/user/1000
```



### ubuntué»˜è®¤ç£ç›˜ç©ºé—´æœªå…¨éƒ¨å ç”¨

```
# æŸ¥çœ‹æœªåˆ†é…ç£ç›˜ç©ºé—´
vgdisplay

# å°†å‰©ä½™çš„å…¨éƒ¨ç©ºé—´ç»™æ ¹ç›®å½•
lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv

# åº”ç”¨ç”Ÿæ•ˆ
resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv

```